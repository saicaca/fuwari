---
title: "TechStackèƒŒåçš„æ•…äº‹: å› éœ€æ±‚è¯ç”Ÿçš„ç‰¹æ®Šæ•°æ®ç»“æ„:æ­£åˆ™Map"
description: ä¸€ä¸ªç‰¹æ®Šçš„æ•°æ®ç»“æ„
published: 2023-08-18T22:45:00+08:00
image: cover.png
category: æŠ€æœ¯
draft: false
tags: [TechStack, Indie Hacker] 
---

## å‰æƒ…
[TechStack](https://github.com/Get-Tech-Stack/TechStack) æ˜¯ä¸€ä¸ªç”¨äºæ˜¾ç¤ºä¸€ä¸ª GitHub é¡¹ç›®çš„æŠ€æœ¯æ ˆçš„æµè§ˆå™¨æ’ä»¶ã€‚åœ¨å¼€å‘å®ƒçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘é‡åˆ°ä¸€ä¸ªæŒºæœ‰æ„æ€çš„æŠ€æœ¯éœ€æ±‚ã€‚

æ¯”å¦‚åœ¨ package.json ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¾èµ–é¡¹ react ç›´æ¥æ˜ å°„åˆ° React æŠ€æœ¯æ ˆã€‚ä½†æ˜¯æœ‰äº›ä¾èµ–å¹¶ä¸æ˜¯è¿™æ ·ã€‚ æ¯”å¦‚ `@radix-ui/react-checkbox` å’Œ `@radix-ui/react-icons` å®ƒä»¬éƒ½å±äº Radix UI çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æœè®©è¿™äº›ä¾èµ–ç›´æ¥å¯¹åº”åˆ° Radix å‘¢?
 
æˆ‘è§‰å¾—å¤§éƒ¨åˆ†äººéƒ½å¾ˆæƒ³å®¹æ˜“æƒ³åˆ°æ­£åˆ™ã€‚å¯¹ï¼Œå¯ä»¥å†™ä¸€ä¸ªæ­£åˆ™ï¼Œå¤§æ¦‚æ˜¯è¿™æ ·`@radix-ui/[\\w-]+`ï¼Œå¦‚æœè¢«å®ƒåŒ¹é…åˆ°å°±æ˜¯ Radixã€‚

æ‰€ä»¥æˆ‘å°±æƒ³æä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œä¸€ä¸ª key å¯ä»¥æ˜¯ string ä¹Ÿå¯ä»¥æ˜¯æ­£åˆ™çš„mapã€‚ğŸ¤”
å°±åƒè¿™æ ·
```
map = {
	"react": "React",
	"@radix-ui/[\\w-]+": "Radix"
}

map["react"] => "React"
map["@radix-ui/react-checkbox"] => "Radix"
map["@radix-ui/react-icons"] => "Radix"
```

å¼€å·¥!

## å®ç°ç¬¬ä¸€ç‰ˆ
å…ˆå¤§æ¦‚éªŒè¯ä¸€ä¸‹æƒ³æ³•çš„å¯è¡Œæ€§ï¼Œæˆ‘ç›´æ¥å¹²äº†ä¸€ä¸ªmapï¼Œå¤§æ¦‚åƒè¿™æ ·
```go
// ä¼ªä»£ç 
type  Map[T any] struct {
    intermap map[string]T
    regexp   []string
}

func (r *Map[T])Store(key string, value T) {
    ç›´æ¥å­˜
}

func (r *Map[T])StoreRegexp(key string, value T) {
    å­˜åˆ°æ­£åˆ™è¡¨è¾¾å¼æ•°ç»„ä¸­
}

// è¿™é‡Œè¿™ä¸ªçœ‹åˆ°ï¼Œè¿”å›å€¼æ¯”ä¸€èˆ¬çš„mapå¤šäº†ä¸€ä¸ª match ï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿è°ƒè¯•çŸ¥é“è¿™ä¸ªstringæ˜¯è¢«å“ªä¸ªæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åˆ°çš„
func (r *Map[T]) Load(key string)  (actual T, loaded bool, match string)  {
    å¦‚æœintermapä¸­æ²¡æœ‰å°±å»éå†æ‰€æœ‰çš„æ­£åˆ™è¡¨è¾¾å¼.
}
```

å½“æˆ‘ä»¬å»å–ä¸€ä¸ªå€¼æ—¶ï¼Œéå†æ‰€æœ‰çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚å¯ä»¥çœ‹åˆ°è¿™ä¸ªå®ç°çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œn ä¸ºæ­£åˆ™è¡¨è¾¾å¼çš„æ•°é‡ã€‚è¿™ä¸ªå¤æ‚åº¦å…¶å®åœ¨æˆ‘çš„ä¸šåŠ¡ä¸­æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå› ä¸ºæ­£åˆ™è¡¨è¾¾å¼çš„æ•°é‡ä¸ä¼šå¤ªå¤šã€‚ğŸ¤”ä½†æ˜¯éƒ½è¦åšæˆåº“çš„è¯ï¼Œè‚¯å®šä¸èƒ½æ­¢æ­¥äºæ­¤ã€‚

## benchmark
å…ˆæ¥åšä¸ªbenchmarkï¼Œä¸ç„¶æ€ä¹ˆèƒ½çŸ¥é“åé¢æå‡å¤šå°‘å‘¢!
```
âœ  benchmark git:(main) âœ—  go test -bench='Map$' . 
goos: darwin
goarch: arm64
pkg: github.com/CorrectRoadH/regexp_map/benchmark
BenchmarkMap-10                          3756829               371.5 ns/op
BenchmarkRegexpMap-10                    4147221               365.4 ns/op
BenchmarkPureRegepxRegexpMap-10           142440              8531 ns/op <- é‡ç‚¹åœ¨è¿™é‡Œï¼Œå…¨æ˜¯æ­£åˆ™è¡¨è¾¾å¼keyçš„æµ‹è¯•
BenchmarkAllxRegexpMap-10                 136924              8788 ns/op <- é‡ç‚¹åœ¨è¿™é‡Œï¼Œæ··åˆæ­£åˆ™è¡¨è¾¾å¼keyå’Œæ™®é€škeyçš„æµ‹è¯•
PASS
```
è¿™é‡Œçœ‹èµ·æ¥æ•°æ®é‡å°çš„æ—¶å€™è¿˜å‡‘åˆï¼Œç›´æ¥ä¸Šå¤§æ•°æ®é‡
```
âœ  benchmark git:(main) âœ—  go test -bench='Map$' -benchtime=5s . 
goos: darwin
goarch: arm64
pkg: github.com/CorrectRoadH/regexp_map/benchmark
Benchmark_Map-10                        18406218               366.6 ns/op
Benchmark_RegexpMap-10                  19119948               423.1 ns/op
Benchmark_PureRegepx_RegexpMap-10          10000           4082512 ns/op <- å¯ä»¥çœ‹åˆ°æ€§èƒ½å½±å“è¿˜æ˜¯éå¸¸æ˜æ˜¾çš„
Benchmark_All_RegexpMap-10                 10000           4097201 ns/op 
PASS
ok      github.com/CorrectRoadH/regexp_map/benchmark    179.822s
```

å¤§æ¦‚æµ‹äº†ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°å½“æ•°æ®é‡è¾¾åˆ°10000æ—¶ï¼Œå°±æ…¢çš„å¯æ€œã€‚ğŸ˜­

## å®ç°ç¬¬äºŒç‰ˆ
ğŸ¤”æˆ‘å½“ç„¶ä¸èƒ½æ»¡è¶³è¿™ä¹ˆå·®çš„æ€§èƒ½è¡¨ç°å‘€! æ€ä¹ˆåšå‘¢? å‡­æˆ‘çš„ç›´è§‰ï¼Œæˆ‘æ„Ÿè§‰å¯èƒ½ç”¨ä¸€ä¸ªäºŒåˆ†å†æ­ä¸€ä¸ªæ ‘å°±èƒ½æŠŠæ—¶é—´å¤æ‚åº¦ä¼˜åŒ–åˆ°Log(N)ï¼Œæ„Ÿè§‰è¿™ä¸ªæ€§èƒ½æ˜¯å¯ä»¥å‹‰å¼ºæ¥å—çš„ã€‚

ç›´æ¥å¼€å·¥ï¼Œå¤§æ¦‚ä»£ç å¦‚ä¸‹
```go
type Map[T any] struct {
	internalMap map[string]T
	regexMap    []string
	RegexpTree  *RegexpNode
}

func (r *Map[T]) StoreRegex(key string, value T) {
	if r.internalMap == nil {
		r.internalMap = make(map[string]T)
	}
	if r.RegexpTree == nil {
		r.RegexpTree = &RegexpNode{}
	}

	_, ok := r.internalMap[key]
	if ok {
        // æ­£åˆ™å·²ç»åœ¨æ ‘ä¸­å­˜åœ¨çš„æƒ…å†µå°±åªè¦æ›¿æ¢å€¼
		r.internalMap[key] = value
	} else {
        æŠŠæ­£åˆ™æ’åˆ°æ ‘ä¸­
    }
}
```

## benchmark
```
âœ  benchmark git:(main) âœ—  go test -bench='Map$' -benchtime 1s .   
goos: darwin
goarch: arm64
pkg: github.com/CorrectRoadH/regexp_map/benchmark
Benchmark_PureRegepx_RegexpMap-10           9561           4392539 ns/op <--æ—§çš„
Benchmark_PureRegepx_V2RegexpMap-10        10000           9758544 ns/op <--æ–°çš„
PASS
ok      github.com/CorrectRoadH/regexp_map/benchmark    140.046s
```
ğŸ¤”å¯ä»¥çœ‹åˆ°å…¶å®æ€§èƒ½ä¸å¢åé™ï¼Œè¿™å¾ˆåç›´è§‰ï¼Œä¸åº”è¯¥æ˜¯è¿™æ ·ã€‚ç›´æ¥ä¸Š pprofï¼Œçœ‹çœ‹é—®é¢˜åœ¨å“ªé‡Œã€‚

é€šè¿‡pprofï¼Œæˆ‘å®šä½åˆ°æ—¶é—´å¤§æ¦‚èŠ±äº† Regexp Compile å’Œ GC ä¸Šï¼Œåè€…å…ˆä¸ç®¡ï¼Œå…ˆçœ‹çœ‹å‰è€…ã€‚æˆ‘ä»¬ç°åœ¨çš„ regexp æ˜¯åœ¨ Store æ—¶ç”Ÿæˆçš„ï¼Œæ‰€ä»¥æ˜æ˜¾ä¼šæœ‰å¤šæ¬¡ä¸å¿…è¦æµªè´¹çš„ Compileï¼Œæ‰€ä»¥è¿™ä¸ªå¯ä»¥lazyä¸€ä¸‹ï¼Œå½“ç”¨åˆ°æ—¶å† Compileã€‚


æˆ‘åŸæ¥çš„ä»£ç å¤§æ¦‚æ˜¯ Insert æ—¶ compile æ­£åˆ™ï¼Œç°åœ¨æ˜¯ Find æ—¶ compile æ­£åˆ™

å› ä¸ºåŸæ¥Insertä¹‹åå¯èƒ½è¿˜ä¼šæœ‰Insertï¼Œä¼šè®©åŸæ¥çš„ç¼–è¯‘å‡ºæ¥æ­£åˆ™ç”¨ä¸ä¸Šï¼Œæ‰€ä»¥è¿™ä¸ªç¼–è¯‘å…¶å®æ˜¯æ— ç”¨çš„ã€‚

## Lazy compile
åœ¨æŠŠä»£ç æ”¹äº†ä¸€ä¸‹ä¹‹åï¼Œå°±OKäº†ã€‚å¯ä»¥çœ‹åˆ°æ€§èƒ½æå‡äº†å¾ˆå¤šã€‚
```
go test -bench='Map$' -benchtime 5s .
goos: darwin
goarch: arm64
pkg: github.com/CorrectRoadH/regexp_map/benchmark
Benchmark_PureRegepx_RegexpMap-10      	   10000	   4339141 ns/op
Benchmark_PureRegepx_V2RegexpMap-10    	   10000	    631144 ns/op <--- å¯ä»¥çœ‹åˆ°æ€§èƒ½æå‡å¾ˆæ˜æ˜¾
PASS
ok  	github.com/CorrectRoadH/regexp_map/benchmark	50.718s
```

## å…¶å®ƒä¼˜åŒ–
ç„¶åå°±æ˜¯åœ¨æ ‘ä¸Šç»§ç»­ä¿®ä¿®æ”¹æ”¹ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æŠŠGCæ—¶é—´ä¹Ÿå‡æ‰ä¸€ç‚¹(å°±æ˜¯å°‘ç”¨æŒ‡é’ˆ)ğŸ¤”ã€‚

### å¦‚ä½•ä¿æŒæ ‘çš„å¹³è¡¡
å¹³è¡¡æ ‘ï¼Œå¤§å®¶å¾ˆå®¹æ˜“æƒ³åˆ°çº¢é»‘æ ‘ã€‚ä½†æ˜¯å…¶å®çº¢é»‘æ ‘å¹¶ä¸é€‚åˆæˆ‘ä»¬ï¼Œå› ä¸ºçº¢é»‘æ ‘ä¼šæ”¹å˜èŠ‚ç‚¹çš„é¡ºåºï¼Œè€Œé¡ºåºä¼šé‡å»º regexpã€‚æ‰€ä»¥æˆ‘ä»¬ç›®å‰æ˜¯å°½å¯èƒ½åœ¨æ’å…¥æ—¶ä¿è¯æ ‘çš„å¹³è¡¡ã€‚ğŸ¤”

æ‰€ä»¥æˆ‘æƒ³åˆ°ä¸€ä¸ªå¾ˆéªšçš„å¹³è¡¡ç®—æ³•ğŸ¤ª éšæœºæ’å…¥ï¼Œé€šè¿‡éšæœºæ€§æ¥ä¿è¯æ ‘çš„å¹³è¡¡ã€‚ğŸ¤£ç›®å‰çœ‹æ¥å…¶å®è¿˜èƒ½æ¥å—ã€‚


### åç»­ä¼˜åŒ–
å…¶å®äºŒå‰æ ‘å¹¶ä¸æ˜¯æ­£åˆ™Mapä¸€ä¸ªé€‚åˆçš„æ ‘ï¼Œå®Œå…¨å¯ä»¥ä¸Šå¤šå‰æ ‘ğŸ¤”æ‰€ä»¥åç»­çš„ä¼˜åŒ–å°±æ˜¯ä¸Šå¤šå‰æ ‘ã€‚åç»­æˆ‘ç ”ç©¶ä¸€ä¸‹ B æ ‘ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æŠŠå€Ÿé‰´ä¸€ä¸‹ç›¸å…³çš„æ€æƒ³ã€‚

### å®‰å…¨æ€§æ£€æŸ¥
å¯ä»¥çœ‹åˆ°è¿™ä¸ªMapæ˜¯æœ‰ä¸€ä¸ªè¦æ±‚çš„ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªæ­£åˆ™è¡¨è¾¾å¼éƒ½è¦èƒ½åŒ¹é…åˆ°ä¸€ä¸ªå”¯ä¸€çš„å€¼ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå®‰å…¨æ€§æ£€æŸ¥ï¼Œæ¥ä¿è¯è¿™ä¸ªè¦æ±‚ã€‚

è¿™ä¸ªå®ç°ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯åˆ¤æ–­æ˜¯ä¸æ˜¯å·¦å³èƒ½åŒ¹é…çš„ä¸Šï¼Œå¦‚æœå·¦å³å­æ ‘éƒ½åŒ¹é…çš„ä¸Šå°±æ˜¯å‡ºé—®é¢˜äº†ã€‚

ä½†æ˜¯è¿™ä¸ªç›®å‰æ²¡æœ‰ä¸€ä¸ªå¥½çš„è¡¨ç°æ–¹å¼ï¼Œæˆ‘æ‰“ç®—é¢å¤–åšä¸€ä¸ªå‡½æ•°ï¼Œæ¯”å¦‚ å®‰å…¨çš„Loadã€‚åœ¨è¿™é‡Œå–å€¼æ—¶é¢å¤–æ£€æŸ¥ï¼Œå¦‚æœé‡åˆ°é—®é¢˜å°±æ˜¯ panicã€‚

### çº¿ç¨‹å®‰å…¨
è¿™ä¸ªæ˜¯è¿˜æ²¡æœ‰åšçš„ï¼Œç›®å‰è¿˜æ˜¯ç”¨æ™®é€šçš„ Mapï¼Œåç»­è€ƒè™‘ç”¨ sync.Map åŠ ä¸€äº›å…¶å®ƒæœºåˆ¶æ¥å®ç°çº¿ç¨‹å®‰å…¨ã€‚

### æ€»ç»“
ä»ä¸€ä¸ªéœ€æ±‚åˆ°è½åœ°ä»£ç ï¼Œå¤§æ¦‚ç”¨äº†ä¸€ä¸ªæ™šä¸Š+ä¸€ä¸ªä¸­åˆã€‚è¿˜æŒºå…´å¥‹çš„ï¼Œç‰¹åˆ«æ˜¯æ¯æ¬¡è·‘é€šæµ‹è¯•ï¼Œæˆ–è€…ä¸€ä¸ª benchmark ç›¸è¾ƒä¹‹å‰æœ‰æ‰€æå‡çš„æ—¶å€™ã€‚ğŸ¤£ è¿˜æ˜¯æŒºæœ‰æˆå°±æ„Ÿçš„ã€‚

## å…¶å®ƒ
ç›®å‰è¿™ä¸ª Regexp Map å·²ç»åœ¨ GitHub ä¸Šäº†ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æ–‡æ¡£å’Œä»£ç  : https://github.com/CorrectRoadH/regexp_map

ç„¶åå°±æ˜¯è¿è¥æ—¶é—´ğŸ˜—
TechStack æ˜¯ä¸€ä¸ªç”¨äºæ˜¾ç¤ºä¸€ä¸ª GitHub é¡¹ç›®çš„æŠ€æœ¯æ ˆçš„æµè§ˆå™¨æ’ä»¶ã€‚å¯ä»¥å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªGithubé¡¹ç›®çš„æŠ€æœ¯æ ˆï¼Œä¸€çœ¼åˆ¤æ–­å‡ºæ˜¯ä¸æ˜¯å‡å¼€æºé¡¹ç›®ã€‚ç›®å‰å·²æ­£å¼ç»“æŸæµ‹è¯•ï¼Œæ¬¢è¿å¤§å®¶æ¥è¯•è¯•ã€‚

Chrome: https://chrome.google.com/webstore/detail/tech-stack-show-github-re/lbhjnhabgddabnagncmcgomggeadlbhh

Firefox:  https://addons.mozilla.org/en-US/firefox/addon/tech-stack/

æ¯”å¦‚è¿™ä¸ª: FastGPTï¼Œè™½ç„¶çœ‹åˆ°è¿™ä¸ªæ˜¯ä¸€ä¸ªå‰ç«¯é¡¹ç›®ï¼Œä¸è¿‡èƒ½çœ‹åˆ°æœ‰è°ƒ OpenAI å’Œç”¨åˆ° Postgres ï¼Œæ‰€ä»¥ä¸€çœ¼å°±å¯ä»¥åˆ¤æ–­å‡ºåº”è¯¥æ˜¯ä¸€ä¸ªçœŸçš„å¼€æºé¡¹ç›®ï¼Œä¹Ÿå¯ä»¥å¤§æ¦‚åˆ¤æ–­å‡ºå®ç°æ€è·¯ï¼Œæ¯”å¦‚æ˜¯ç”¨ Postgres åšå‘é‡æ•°æ®åº“ã€‚
![FastGPT GitHub ä¸»é¡µçš„æˆªå›¾](1.png)